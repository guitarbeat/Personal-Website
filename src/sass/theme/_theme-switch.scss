@use "sass:map";
@use "../tokens/_functions" as f;
@use "../base/_breakpoints" as *;
@use './_keyframes';
@use "../tokens/_tokens" as tokens;

// Combined Theme Variables & Component
// ===================================

// Device Screen Configurations
$screens: (
  default: (
    width: 4em,
    height: 2em,
    thumb: 2em,
    breakpoint: null,
  ),
  tablet: (
    width: 3.5em,
    height: 1.6em,
    thumb: 1.6em,
    breakpoint: tokens.breakpoint('tablet'),
  ),
  mobile-large: (
    width: 3.2em,
    height: 1.5em,
    thumb: 1.5em,
    breakpoint: tokens.breakpoint('phone'),
  ),
  mobile: (
    width: 3em,
    height: 1.4em,
    thumb: 1.4em,
    breakpoint: tokens.breakpoint('mobile'),
  ),
  mobile-small: (
    width: 2.5em,
    height: 1.2em,
    thumb: 1.2em,
    breakpoint: 320px,
  ),
);

// Theme Switch Configuration
$theme-switch: (
  'animation': (
    'duration': (
      'default': 8s,
      'reduced': 16s
    ),
    'timing': cubic-bezier(0.4, 0, 0.2, 1)
  ),
  'colors': (
    'moon': (
      'dark': #04162E,
      'light': #B5BCC6
    ),
    'sun': (
      'core': #FDB813,
      'corona': (
        'start': rgb(253 184 19 / 70%),
        'end': rgb(255 94 0 / 10%)
      )
    )
  ),
  'position': (
    'top': clamp(0.5rem, 1.5vh, 1.25rem),
    'left': clamp(0.75rem, 2vw, 1.5rem),
    'offset-x': 0.5rem,
    'offset-y': 0.25rem
  ),
  'screens': (
    'tablet': 768px,
    'mobile': 480px
  ),
  'sizes': (
    'base': (
      'width': clamp(3rem, 4vw, 4.5rem),
      'height': clamp(1.5rem, 2vw, 2.25rem)
    )
  )
);

// Theme Colors
$theme-colors: (
  'light': (
    'start': #78D6C6,   // Light teal
    'mid': #419197,     // Mid teal
    'end': #04162E,     // Dark blue
    'handle': (
      'start': #B5BCC6, // Light grey
      'mid': #F3F2F1,   // Highlight
      'end': #49676B    // Light black
    )
  ),
  'dark': (
    'start': #04162E,   // Dark blue
    'mid': #365059,     // Deep teal
    'end': #000038,     // Navy
    'handle': (
      'start': #ff7d66, // Warm red
      'mid': #F5FCCD,   // Highlight
      'end': #49676B    // Light black
    )
  )
);

// Theme Switch Component Styles
// ==============================
.theme-switch {
  --switch-width: #{map.get($theme-switch, 'sizes', 'base', 'width')};
  --switch-height: #{map.get($theme-switch, 'sizes', 'base', 'height')};
  --switch-border-radius: calc(var(--switch-height) / 2);
  --switch-padding: 0.2rem;
  --switch-handle-size: calc(var(--switch-height) - 2 * var(--switch-padding));
  --handle-translate: 0;

  position: relative;
  margin-left: auto;
  margin-right: 1rem;
  z-index: 9999;
  width: var(--switch-width);
  height: var(--switch-height);
  border-radius: var(--switch-border-radius);
  background: linear-gradient(
    90deg,
    map.get($theme-colors, 'light', 'start') 0%,
    map.get($theme-colors, 'light', 'mid') 50%,
    map.get($theme-colors, 'light', 'end') 100%
  );
  background-size: 200% 100%;
  background-position: 0 0;
  border: none;
  cursor: pointer;
  overflow: hidden;
  transition:
    background-position 1s cubic-bezier(0.4, 0, 0.2, 1),
    transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
  animation:
    switchEntrance 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards,
    cosmicFloat 8s ease-in-out infinite;
  margin: 0;
  opacity: 1;
  box-shadow:
    0 2px 8px rgb(0 0 0 / 15%),
    inset 0 1px 2px rgb(255 255 255 / 10%);
  outline: none;

  .switch-handle {
    position: absolute;
    top: var(--switch-padding);
    left: var(--switch-padding);
    width: var(--switch-handle-size);
    height: var(--switch-handle-size);
    border-radius: 50%;
    background: linear-gradient(
      180deg,
      map.get($theme-colors, 'dark', 'handle', 'start') -50%,
      map.get($theme-colors, 'dark', 'handle', 'mid') 50%,
      map.get($theme-colors, 'dark', 'handle', 'end') 150%
    );
    background-size: 100% 200%;
    transform: translateX(var(--handle-translate));
    transform-origin: center;
    transition:
      transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55),
      background 0.8s ease,
      box-shadow 0.3s ease;
    box-shadow:
      0 2px 8px rgb(0 0 0 / 20%),
      inset 0 2px 4px rgb(255 255 255 / 20%);

    &::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 50%;
      background: radial-gradient(circle at 50% 0%, rgb(255 255 255 / 20%) 0%, transparent 60%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
  }

  &.light-theme {
    background-position: 100% 0;
    --handle-translate: calc(var(--switch-width) - var(--switch-height));
  }

  &:focus-visible {
    outline: none;
    box-shadow:
      0 0 0 3px rgb(255 255 255 / 55%),
      0 0 0 5px rgb(0 0 0 / 35%),
      0 2px 8px rgb(0 0 0 / 15%),
      inset 0 1px 2px rgb(255 255 255 / 10%);
  }

  &:hover,
  &:focus-visible {
    transform: none;

    .switch-handle {
      transform: translateX(var(--handle-translate)) scale(1.08);

      &::before {
        opacity: 1;
      }
    }
  }

  &::after {
    content: '';
    position: absolute;
    inset: -2px;
    border-radius: inherit;
    background: radial-gradient(
      circle at var(--mouse-x, 50%) var(--mouse-y, 50%),
      rgb(255 255 255 / 15%) 0%,
      transparent 60%
    );
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
  }

  &:hover::after,
  &:focus-visible::after {
    opacity: 1;
  }
}

@media (prefers-reduced-motion: reduce) {
  .theme-switch {
    animation: none;

    .switch-handle {
      transition:
        background 0.8s ease,
        box-shadow 0.3s ease;
    }

    &:hover,
    &:focus-visible {
      .switch-handle {
        transform: translateX(var(--handle-translate));
      }
    }
  }
}

@media (max-width: map.get($theme-switch, 'screens', 'tablet')) {
  .theme-switch {
    --switch-width: calc(#{map.get($theme-switch, 'sizes', 'base', 'width')} * 0.8);
    --switch-height: calc(#{map.get($theme-switch, 'sizes', 'base', 'height')} * 0.8);
    animation:
      cosmicFloat 6s ease-in-out infinite,
      switchEntrance 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
}

@media (max-width: map.get($theme-switch, 'screens', 'mobile')) {
  .theme-switch {
    animation:
      cosmicFloat 4s ease-in-out infinite,
      switchEntrance 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
}

@media (width <= 767px) {
  .theme-switch {
    margin-right: 0.5rem;
  }
}
