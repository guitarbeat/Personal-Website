@use "sass:map";
@use "sass:color";
@use "../base" as base;

// Configuration Map
$config: (
  blur: (
    strength: 70px,
    saturation: 2.2,
    fallback-opacity: 0.9
  ),
  dimensions: (
    desktop: 10rem,
    mobile: 6rem
  ),
  gradient: (
    opacity: 0.9,
    stop: 80%,
    colors: (
      start: rgba(#000, 0),
      middle: rgba(#000, 0.9),
      end: #000
    )
  ),
  animation: (
    duration: 2s,
    delay: 0.5s,
    timing: ease-out
  ),
  transition: cubic-bezier(0.4, 0.0, 0.2, 1),
  z-index: var(--z-index-vignette)
);

// Getter Functions
@function get-config($keys...) {
  $value: $config;
  @each $key in $keys {
    $value: map.get($value, $key);
  }
  @return $value;
}

// Animation Mixin
@mixin vignette-animation($direction) {
  $duration: get-config('animation', 'duration');
  $delay: get-config('animation', 'delay');
  $timing: get-config('animation', 'timing');
  
  animation: vignette-#{$direction} $duration $timing;
  animation-delay: $delay;
  animation-fill-mode: forwards;
}

// Gradient Mixin
@mixin gradient-mask($direction: 'to bottom') {
  $gradient-colors: get-config('gradient', 'colors');
  $opacity: get-config('gradient', 'opacity');
  $stop: get-config('gradient', 'stop');
  
  mask-image: linear-gradient(
    #{$direction},
    map.get($gradient-colors, 'start'),
    map.get($gradient-colors, 'middle') $stop,
    map.get($gradient-colors, 'end')
  );
  -webkit-mask-image: linear-gradient(
    #{$direction},
    map.get($gradient-colors, 'start'),
    map.get($gradient-colors, 'middle') $stop,
    map.get($gradient-colors, 'end')
  );
}

// Blur Effect Mixin
@mixin blur-effect {
  $strength: get-config('blur', 'strength');
  $saturation: get-config('blur', 'saturation');
  
  backdrop-filter: blur($strength) saturate($saturation);
  -webkit-backdrop-filter: blur($strength) saturate($saturation);
  mix-blend-mode: multiply;
  
  @supports not (backdrop-filter: blur($strength)) {
    background: rgba(0, 0, 0, get-config('blur', 'fallback-opacity'));
  }
}

// Base Vignette Styles
%vignette-base {
  position: fixed;

  width: 100%;
  pointer-events: none;
  z-index: get-config('z-index');
  transition: all 0.5s get-config('transition');
}

// Main Vignette Classes
.vignette {
  &-top {
    @extend %vignette-base;
    top: 0;
    left: 0;
    height: get-config('dimensions', 'desktop');
    
    &::before {
      content: "";
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      display:block;
      @include blur-effect;
      @include gradient-mask('to bottom');
      @include vignette-animation('slide-down');
    }
    
    @include base.respond(small) {
      height: get-config('dimensions', 'mobile');
    }
  }

  &-bottom {
    @extend %vignette-base;
    bottom: 0;
    left: 0;
    width: 100%;
    height: get-config('dimensions', 'mobile');
    
    &::before {
      content: "";
      position: absolute;
      inset: 0;
      @include blur-effect;
      @include gradient-mask('to top');
      @include vignette-animation('slide-up');
    }
  }
}

@keyframes vignette-slide-down {
  from {
    transform: translate(0, -100%);
    opacity: 0;
  }
  to {
    transform: translate(0, 0);
    opacity: 1;
  }
}

@keyframes vignette-slide-up {
  from {
    transform: translate(0, 100%);
    opacity: 0;
  }
  to {
    transform: translate(0, 0);
    opacity: 1;
  }
}